<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulador EXANI-II UV PRO</title>
<style>
    :root {
        --primary-color: #1976D2;
        --hover-color: #0d47a1;
        --bg-color: #f0f2f5;
        --text-color: #333;
    }
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: var(--bg-color);
        color: var(--text-color);
        text-align: center;
        margin: 0;
        padding: 20px;
    }
    .container {
        background: white;
        width: 100%;
        max-width: 600px;
        margin: 0 auto;
        padding: 30px 20px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        box-sizing: border-box;
    }
    h1 { color: var(--primary-color); font-size: 1.5rem; margin-top: 0;}
    .stats {
        display: flex;
        justify-content: space-around;
        background: #e3f2fd;
        padding: 10px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-weight: bold;
    }
    button {
        padding: 12px 20px;
        margin: 8px;
        border: none;
        border-radius: 8px;
        background: var(--primary-color);
        color: white;
        font-size: 1rem;
        cursor: pointer;
        transition: background 0.3s;
        width: 100%;
        max-width: 250px;
    }
    button:hover { background: var(--hover-color); }
    .hidden { display: none !important; }
    
    .question { text-align: left; margin: 20px 0; }
    .question p { font-size: 1.1rem; font-weight: bold; }
    
    .option-label {
        display: block;
        background: #f8f9fa;
        padding: 12px;
        margin: 8px 0;
        border-radius: 6px;
        border: 1px solid #dee2e6;
        cursor: pointer;
        transition: all 0.2s;
    }
    .option-label:hover { background: #e3f2fd; border-color: var(--primary-color); }
    input[type="radio"] { margin-right: 10px; transform: scale(1.2); }
    
    .correct { color: #2e7d32; font-weight: bold; }
    .incorrect { color: #c62828; font-weight: bold; }
    .review-item {
        background: #f8f9fa;
        padding: 15px;
        margin: 10px 0;
        border-radius: 8px;
        text-align: left;
        border-left: 5px solid #ccc;
    }
    .review-item.ok { border-left-color: #2e7d32; }
    .review-item.fail { border-left-color: #c62828; }
    
    /* Nuevo estilo para las explicaciones */
    .explanation {
        background: #fff3cd;
        color: #856404;
        padding: 10px;
        border-radius: 5px;
        margin-top: 10px;
        font-size: 0.95rem;
        border-left: 4px solid #ffeeba;
    }
</style>
</head>
<body>

<div class="container">
    <h1>Simulador EXANI-II UV</h1>
    
    <div class="stats">
        <span>D√≠a: <span id="day"></span></span>
        <span>Racha: <span id="streak">üî•</span></span>
    </div>

    <div id="subjects">
        <h3>Selecciona un m√≥dulo:</h3>
        <button onclick="startExam('lectura')">Comprensi√≥n Lectora</button>
        <button onclick="startExam('redaccion')">Redacci√≥n Indirecta</button>
        <button onclick="startExam('mate')">Pensamiento Matem√°tico</button>
    </div>

    <div id="exam" class="hidden">
        <h2 id="title"></h2>
        <h4 style="color: #666;" id="progressText"></h4>
        <div id="questionBox"></div>
        <button onclick="nextQuestion()">Siguiente</button>
    </div>

    <div id="results" class="hidden"></div>
</div>

<script>
let day = localStorage.getItem("day") ? parseInt(localStorage.getItem("day")) : 1;
let streak = localStorage.getItem("streak") ? parseInt(localStorage.getItem("streak")) : 0;

document.getElementById("day").innerText = day;
document.getElementById("streak").innerText = streak;

let currentSubject = "";
let questionIndex = 0;
let correctCount = 0;
let selectedQuestions = [];
let userAnswers = [];
let totalQuestionsForExam = 5; // <--- Hacemos el examen de 5 preguntas para que var√≠en al repetir

// ===== BANCO DE PREGUNTAS CON EXPLICACIONES (exp) =====
const bank = {
    mate:[
        {level:"facil",q:"¬øCu√°nto es el 25% de 200?",o:["25","40","50","75"],a:2, exp:"El 25% equivale a la cuarta parte de una cantidad. Dividimos 200 entre 4 y el resultado es 50. Tambi√©n puedes multiplicar 200 x 0.25."},
        {level:"facil",q:"Si x + 3 = 7, el valor de x es:",o:["2","3","4","5"],a:2, exp:"Para despejar 'x', pasamos el 3 al otro lado restando: x = 7 - 3. Por lo tanto, x = 4."},
        {level:"facil",q:"3/4 es equivalente a:",o:["0.25","0.5","0.75","1.25"],a:2, exp:"Para convertir una fracci√≥n a decimal, divides el numerador (3) entre el denominador (4). 3 √∑ 4 = 0.75."},
        {level:"media",q:"Si 5 l√°pices cuestan $20, ¬øcu√°nto cuestan 8?",o:["28","30","32","35"],a:2, exp:"Primero sacamos el valor unitario: 20 √∑ 5 = $4 cada l√°piz. Luego multiplicamos por los 8 l√°pices: 8 x 4 = $32."},
        {level:"media",q:"Resuelve: 2x - 4 = 10",o:["6","7","8","9"],a:1, exp:"Pasamos el -4 al otro lado sumando: 2x = 10 + 4 (2x = 14). Luego, el 2 pasa dividiendo: x = 14 √∑ 2. Resultado: x = 7."},
        {level:"media",q:"Una sucesi√≥n aumenta de 3 en 3: 3, 6, 9,... ¬øcu√°l es el siguiente?",o:["10","11","12","13"],a:2, exp:"La regla de la sucesi√≥n es sumar 3 al t√©rmino anterior. 9 + 3 = 12."},
        {level:"media",q:"Probabilidad de sacar cara en una moneda:",o:["0","0.25","0.5","1"],a:2, exp:"La probabilidad es (Casos favorables) / (Casos totales). Hay 1 cara en 2 posibles resultados (cara o cruz). 1 √∑ 2 = 0.5."},
        {level:"dificil",q:"Si 2x + 3y = 12 y x=3, entonces y es:",o:["1","2","3","4"],a:1, exp:"Sustituimos la x: 2(3) + 3y = 12 -> 6 + 3y = 12. Pasamos el 6 restando: 3y = 6. Pasamos el 3 dividiendo: y = 6 √∑ 3. Resultado: y = 2."},
        {level:"dificil",q:"√Årea de un tri√°ngulo de base 10 y altura 6:",o:["30","60","20","16"],a:0, exp:"La f√≥rmula es (base x altura) / 2. Multiplicamos 10 x 6 = 60. Luego dividimos entre 2, lo que nos da 30."},
        {level:"dificil",q:"Inter√©s simple del 10% de $1000 en 1 a√±o:",o:["50","100","150","200"],a:1, exp:"La f√≥rmula de inter√©s simple es I = C * r * t.  (1000 * 0.10 * 1). El 10% de 1000 es 100."}
    ],
    lectura:[
        {level:"facil",q:"La idea principal es:",o:["Un detalle secundario","El tema central","Un ejemplo","El t√≠tulo del texto"],a:1, exp:"La idea principal es el n√∫cleo del texto, aquello de lo que se habla de forma central y que engloba el mensaje principal."},
        {level:"facil",q:"Inferir significa:",o:["Copiar textualmente","Deducir informaci√≥n no expl√≠cita","Subrayar ideas","Enumerar p√°rrafos"],a:1, exp:"Inferir es 'leer entre l√≠neas'. Es sacar una conclusi√≥n basada en pistas del texto, aunque no est√© escrito directamente."},
        {level:"media",q:"Un texto que intenta convencer es de tipo:",o:["Narrativo","Argumentativo","Descriptivo","L√≠rico"],a:1, exp:"Los textos argumentativos buscan persuadir o convencer al lector sobre un punto de vista mediante razones o argumentos."},
        {level:"media",q:"Un conector de contraste es:",o:["Porque","Aunque","Adem√°s","Entonces"],a:1, exp:"'Aunque' introduce una idea que contrasta o se opone parcialmente a la anterior (ej. Fui al cine, aunque estaba lloviendo)."},
        {level:"media",q:"El prop√≥sito informativo significa:",o:["Convencer al lector","Dar a conocer hechos objetivos","Criticar una postura","Narrar una ficci√≥n"],a:1, exp:"Los textos informativos (como las noticias) solo buscan presentar hechos y datos reales sin emitir opiniones."},
        {level:"dificil",q:"Si algo no se dice expl√≠cito pero se entiende, es una:",o:["S√≠ntesis","Inferencia","Copia literal","Par√°frasis"],a:1, exp:"La inferencia es la deducci√≥n de informaci√≥n que est√° impl√≠cita en el texto."},
        {level:"dificil",q:"La relaci√≥n causa-efecto implica:",o:["Una comparaci√≥n","Un motivo y su resultado","Una opini√≥n personal","Una ubicaci√≥n espacial"],a:1, exp:"Causa es por qu√© ocurre algo (el motivo) y el efecto es lo que ocurre (el resultado)."},
        {level:"dificil",q:"La conclusi√≥n generalmente se ubica en:",o:["El inicio","El desarrollo","El final","El t√≠tulo"],a:2, exp:"La conclusi√≥n es el cierre del texto, donde se hace un resumen de las ideas principales o se da un veredicto final, siempre va al final."}
    ],
    redaccion:[
        {level:"facil",q:"¬øCu√°l oraci√≥n est√° bien escrita?",o:["El ni√±o comio","El ni√±o comi√≥","El ni√±o com√≠o","El ni√±o comi√≤"],a:1, exp:"'Comi√≥' es una palabra aguda terminada en vocal, por lo tanto debe llevar tilde (acento ortogr√°fico) en la √∫ltima s√≠laba (√≥)."},
        {level:"facil",q:"Uso correcto para preguntar:",o:["Porque no vienes?","¬øPor qu√© no vienes?","Porqu√© no vienes?","Por que no vienes?"],a:1, exp:"Para hacer una pregunta, se usa 'Por qu√©' (separado y con tilde en la e). Adem√°s, en espa√±ol se usan los dos signos de interrogaci√≥n (¬ø?)."},
        {level:"media",q:"Concordancia correcta:",o:["Las perro corre","Los perros corren","El perros corre","La perros corren"],a:1, exp:"El art√≠culo, el sustantivo y el verbo deben coincidir en g√©nero (masculino) y n√∫mero (plural). 'Los perros corren' es la √∫nica correcta."},
        {level:"media",q:"Uso correcto de la coma:",o:["Hola Juan como estas","Hola, Juan, ¬øc√≥mo est√°s?","Hola Juan, como estas","Hola, Juan como estas"],a:1, exp:"Se debe usar una coma para separar el 'vocativo' (el nombre de la persona a la que le hablamos). 'Hola, Juan' es lo correcto."},
        {level:"dificil",q:"Identifica la palabra esdr√∫jula:",o:["Cantar","Cami√≥n","L√°piz","√Årboles"],a:3, exp:"Las esdr√∫julas tienen la s√≠laba t√≥nica en la antepen√∫ltima s√≠laba (√ÅR-bo-les). L√°piz es llana, Cami√≥n es aguda y Cantar es aguda."},
        {level:"dificil",q:"Acentuaci√≥n correcta:",o:["Rap√≠do","R√°pido","Rapido","Rapi√≠do"],a:1, exp:"'R√°pido' es una palabra esdr√∫jula (R√Å-pi-do). Todas las palabras esdr√∫julas llevan tilde siempre."}
    ]
};

function startExam(subject){
    currentSubject = subject;
    questionIndex = 0;
    correctCount = 0;
    userAnswers = [];

    // Mezclamos TODAS las preguntas del banco
    let allQuestions = shuffle([...bank[subject]]);
    
    // Si el banco tiene m√°s preguntas que totalQuestionsForExam (5), toma solo 5.
    // As√≠ en cada intento las preguntas ser√°n diferentes.
    let limit = Math.min(totalQuestionsForExam, allQuestions.length); 
    selectedQuestions = allQuestions.slice(0, limit);

    document.getElementById("subjects").classList.add("hidden");
    document.getElementById("exam").classList.remove("hidden");
    document.getElementById("results").classList.add("hidden");

    let titles = {
        mate: "Pensamiento Matem√°tico",
        lectura: "Comprensi√≥n Lectora",
        redaccion: "Redacci√≥n Indirecta"
    };

    document.getElementById("title").innerText = titles[subject];
    showQuestion();
}

function showQuestion(){
    document.getElementById("progressText").innerText = `Pregunta ${questionIndex + 1} de ${selectedQuestions.length}`;
    
    let q = selectedQuestions[questionIndex];
    document.getElementById("questionBox").innerHTML = `
        <div class="question">
            <p>${q.q}</p>
            ${q.o.map((opt, i) =>
                `<label class="option-label">
                    <input type="radio" name="option" value="${i}"> ${opt}
                </label>`
            ).join("")}
        </div>`;
}

function nextQuestion(){
    let selected = document.querySelector('input[name="option"]:checked');
    if(!selected){
        alert("Por favor, selecciona una respuesta antes de continuar.");
        return;
    }

    let val = parseInt(selected.value);
    userAnswers.push(val);

    if(val === selectedQuestions[questionIndex].a){
        correctCount++;
    }

    questionIndex++;

    if(questionIndex < selectedQuestions.length){
        showQuestion();
    } else {
        finishExam();
    }
}

function finishExam(){
    document.getElementById("exam").classList.add("hidden");
    let div = document.getElementById("results");
    div.classList.remove("hidden");

    let isPerfect = correctCount === selectedQuestions.length;
    
    let resultHTML = `<h2>Resultado Final</h2>
                      <p>Respuestas correctas: <strong>${correctCount} de ${selectedQuestions.length}</strong></p>`;

    if(isPerfect){
        streak++;
        day++;
        localStorage.setItem("streak", streak);
        localStorage.setItem("day", day);
        resultHTML += `<h3 class="correct">¬°Excelente trabajo! Subes de nivel de racha üî•</h3>`;
    } else {
        streak = 0;
        localStorage.setItem("streak", streak);
        resultHTML += `<h3 class="incorrect">Fallaste algunas. ¬°La racha vuelve a cero! üíî</h3>
                       <p>Revisa las explicaciones abajo e intenta de nuevo para pasar el d√≠a.</p>`;
    }

    document.getElementById("day").innerText = day;
    document.getElementById("streak").innerText = streak;

    resultHTML += `<h3>Revisi√≥n de tu examen:</h3><div style="max-height: 500px; overflow-y: auto; padding-right: 10px;">`;

    selectedQuestions.forEach((q, i) => {
        let isCorrect = userAnswers[i] === q.a;
        let statusClass = isCorrect ? "ok" : "fail";
        let statusText = isCorrect ? `<span class="correct">‚úî Correcta</span>` : `<span class="incorrect">‚úñ Incorrecta</span>`;
        
        resultHTML += `
            <div class="review-item ${statusClass}">
                <p><strong>Pregunta ${i+1}:</strong> ${q.q}</p>
                <p>${statusText}</p>
                ${!isCorrect ? `
                    <p style="color:#666; font-size:0.9em;">
                    Tu respuesta: ${q.o[userAnswers[i]]}<br>
                    <strong>Respuesta correcta: ${q.o[q.a]}</strong>
                    </p>
                ` : ''}
                <div class="explanation"><strong>Explicaci√≥n:</strong> ${q.exp}</div>
            </div>`;
    });

    resultHTML += `</div><br><button onclick="location.reload()">Volver al Men√∫ Principal</button>`;
    div.innerHTML = resultHTML;
}

function shuffle(array){
    for(let i = array.length - 1; i > 0; i--){
        let j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}
</script>
</body>
</html>
